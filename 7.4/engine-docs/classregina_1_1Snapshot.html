<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Regina 7.4 Calculation Engine: regina::Snapshot&lt; T &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Regina 7.4 Calculation Engine
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',false);
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceregina.html">regina</a></li><li class="navelem"><a class="el" href="classregina_1_1Snapshot.html">Snapshot</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#friends">Friends</a> &#124;
<a href="classregina_1_1Snapshot-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">regina::Snapshot&lt; T &gt; Class Template Reference<div class="ingroups"><a class="el" href="group__utilities.html">Miscellaneous Utilities</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Keeps a snapshot of an object of type <em>T</em> as it was at a particular moment in time.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;utilities/snapshot.h&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="friends" name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a74c434c5a1e6d4497bdcaf8035fef99f" id="r_a74c434c5a1e6d4497bdcaf8035fef99f"><td class="memItemLeft" align="right" valign="top"><a id="a74c434c5a1e6d4497bdcaf8035fef99f" name="a74c434c5a1e6d4497bdcaf8035fef99f"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>Snapshottable&lt; T &gt;</b></td></tr>
<tr class="separator:a74c434c5a1e6d4497bdcaf8035fef99f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d6d9a60489fba0f8ade9f81da1536a" id="r_a55d6d9a60489fba0f8ade9f81da1536a"><td class="memItemLeft" align="right" valign="top"><a id="a55d6d9a60489fba0f8ade9f81da1536a" name="a55d6d9a60489fba0f8ade9f81da1536a"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SnapshotRef&lt; T &gt;</b></td></tr>
<tr class="separator:a55d6d9a60489fba0f8ade9f81da1536a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;class T&gt;<br />
class regina::Snapshot&lt; T &gt;</div><p>Keeps a snapshot of an object of type <em>T</em> as it was at a particular moment in time. </p>
<p>To describe how this class works, we need some terminology:</p>
<ul>
<li>the <em>image</em> is a single object of type <em>T</em> whose snapshot we are taking;</li>
<li>the <em>viewers</em> are many object of other types that all require access to this snapshot.</li>
</ul>
<p>The life cycle of this process is as follows:</p>
<ul>
<li>An image <em>I</em> is created and modified over time; initially it remains uninvolved in the snapshotting machinery.</li>
<li>At some point in time, a viewer <em>V1</em> wishes to take a snapshot of <em>I</em>. To do this, it creates a <em>snapshot reference</em> <code>SnapshotRef(I)</code>. This is a cheap operation that "enrols" <em>I</em> in the snapshotting machinery, by creating a single <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> object <em>S</em>.</li>
<li>More viewers may take snapshots of <em>I</em>, either by creating a new <code>SnapshotRef(I)</code> or by copying other viewers' snapshot references. Again, these are all cheap operations. All references to <em>I</em> will refer to the same snapshot object <em>S</em>.</li>
<li>If the image is about to modify itself or be destroyed, it notifies its snapshot <em>S</em>, which in turn takes a deep copy of <em>I</em> and stores it for safekeeping. This is an expensive operation. The original image now loses its link to <em>S</em>, and becomes "unenrolled" from the snapshotting machinery again; the only way to access the original snapshot at this point is by copying other references.</li>
<li>After the image was modified, making a new <code>SnapshotRef(I)</code> will re-enrol <em>I</em> and create a completely new <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> object. The original <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> may of course still exist, maintaining its copy of <em>I</em> as it used to be.</li>
<li>Each snapshot <em>S</em> is reference counted: when the last reference to it is destroyed, then <em>S</em> is also destroyed (along with the deep copy of the original image, if one was ever made).</li>
</ul>
<p>Regarding access to the image:</p>
<ul>
<li>A <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> and <a class="el" href="classregina_1_1SnapshotRef.html" title="A reference to an image of type T that has been snapshotted at a particular moment in time.">SnapshotRef</a> can outlive the original image <em>I</em>.</li>
<li>It is important that every snapshot reference only ever accesses the underlying image via the <a class="el" href="classregina_1_1SnapshotRef.html" title="A reference to an image of type T that has been snapshotted at a particular moment in time.">SnapshotRef</a> dereference operators. This is because the image may change to be a different object if the original is modified or destroyed.</li>
<li><a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> references are only ever granted <em>read-only</em> access to the image. Semantically this makes sense (since this is a snapshot); also this avoids unpleasant lifespan questions if someone tries to modify a <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a>'s internal deep copy. If you need write access from a snapshot, then take your own deep copy and modify that: it is no less efficient (since the snapshot would have taken a copy otherwise), and this way the ownership and lifespan semantics are clear. Any attempt to cast away constness and modify the image through a snapshot may result in a <a class="el" href="classregina_1_1SnapshotWriteError.html" title="An exception thrown when someone tries to modify the read-only deep copy taken by a snapshot.">regina::SnapshotWriteError</a> exception being thrown.</li>
</ul>
<p>This snapshotting machinery is, in some ways, a slimmed-down variant of copy-on-write machinery, designed to be easily plugged into type <em>T</em>. The requirement on <em>T</em> are as follows:</p>
<ul>
<li><em>T</em> must derive from the base class Snapshottable&lt;T&gt;. The overhead is one extra pointer to the storage for <em>T</em>.</li>
<li>If <em>T</em> supports move/copy construction, move/copy assignment and/or swapping, then their implementations must call the corresponding operations from the base class Snapshottable&lt;T&gt;.</li>
<li>In particular, <em>T</em> must have a copy constructor. This will be used by the snapshot whenever it needs to take its own deep copy.</li>
<li>Whenever an object of type <em>T</em> changes, it <em>must</em> call <a class="el" href="classregina_1_1Snapshottable.html#ac7e625e918d497e1a006bc13b64a1d4f" title="Must be called before modification and/or destruction of the type T contents.">Snapshottable&lt;T&gt;::takeSnapshot()</a> from within the modifying member function, <em>before</em> the change takes place (though there are a handful of exceptions to this requirement, described in the <a class="el" href="classregina_1_1Snapshottable.html" title="A base class for images of type T that can be snapshotted at a particular moment in time.">Snapshottable</a> class notes). If the object does not have a current snapshot, this is very fast (a single test for a null pointer). If the object does have a current snapshot, then this will be expensive since it will trigger a deep copy.</li>
<li>Likewise, in the destructor for <em>T</em>, the first call should be to <a class="el" href="classregina_1_1Snapshottable.html#ac7e625e918d497e1a006bc13b64a1d4f" title="Must be called before modification and/or destruction of the type T contents.">Snapshottable&lt;T&gt;::takeSnapshot()</a>.</li>
<li>If you are doing a complex series of modifications, it is not essential to worry about multiple calls to takeSnapshot() coming from nested modificiation routines, since only the first of these calls could be expensive. (This is in contrast, for instance, to the packet listener machinery, where nested modifications need to be managed more carefully because firing a packetToBeChanged() event will always iterate through all registered listeners.)</li>
</ul>
<p>Regarding multithreading:</p>
<ul>
<li>In general, this class is <em>not</em> thread-safe; in particular, the code that creates new snapshots, takes deep copies before modification, destroys snapshots, and enrols/unenrols images from the snapshot machinery is all unsafe for multithreading.</li>
<li>However: the reference counting machinery <em>is</em> thread-safe. This means that, if your image is not being modified and you already have one snapshot reference <em>R</em>, it is safe to create more references, access the image through your references, and/or destroy references, all from multiple threads, as long as one reference always remains.</li>
<li>This means that, again assuming your image is not being modified, you can hold on to a particular snapshot reference <em>R</em> and use that as a "temporary guarantee" of thread-safety.</li>
<li>All of this requires a bit of care. However, the trade-off is that frequent operations (including <a class="el" href="classregina_1_1Snapshottable.html#ac7e625e918d497e1a006bc13b64a1d4f" title="Must be called before modification and/or destruction of the type T contents.">Snapshottable&lt;T&gt;::takeSnapshot()</a> which must be called on every object of type <em>T</em> before every modification, even if no snapshots exist), can take place without the overhead of locking and unlocking mutexes.</li>
</ul>
<p>This <a class="el" href="classregina_1_1Snapshot.html" title="Keeps a snapshot of an object of type T as it was at a particular moment in time.">Snapshot</a> class itself should remain forever behind the scenes: end users cannot access it and should not know about it. Images should always work through their base class Snapshottable&lt;T&gt;, and viewers shoudl always work through SnapshotRef&lt;T&gt;.</p>
<dl class="section user"><dt>Python</dt><dd>Not present. </dd></dl>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>utilities/<a class="el" href="snapshot_8h.html">snapshot.h</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Copyright &copy; 1999&ndash;2025, The Regina development team
</small></address>
</div><!-- doc-content -->
</body>
</html>
